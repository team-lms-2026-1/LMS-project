# ============================================================
# Nginx 설정 파일 참고용 템플릿
# 실제 설정은 nginx-setup.sh 스크립트가 자동으로 작성합니다.
# 경로: /etc/nginx/conf.d/lms.conf
# ============================================================

# HTTP → HTTPS 리다이렉트 (Certbot이 아래 블록을 자동 생성해줌)
server {
    listen 80;
    server_name teamlms.duckdns.org;
    client_max_body_size 80M;
    return 301 https://$host$request_uri;
}

# HTTPS 메인 서버 블록 (Certbot이 인증서 경로를 자동 주입)
server {
    listen 443 ssl;
    server_name teamlms.duckdns.org;

    # 파일 업로드 용량 제한 해제 (스프링부트 설정인 80MB에 맞춤)
    client_max_body_size 80M;

    # SSL 인증서 (Certbot이 자동 발급/주입)
    ssl_certificate     /etc/letsencrypt/live/teamlms.duckdns.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/teamlms.duckdns.org/privkey.pem;

    # 모든 요청 → Next.js (포트 3000) 으로 프록시
    location / {
        proxy_pass          http://localhost:3000;
        proxy_http_version  1.1;
        proxy_set_header    Upgrade $http_upgrade;
        proxy_set_header    Connection 'upgrade';
        proxy_set_header    Host $host;
        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto $scheme;
        proxy_cache_bypass  $http_upgrade;
        proxy_read_timeout  60s;
    }
}
